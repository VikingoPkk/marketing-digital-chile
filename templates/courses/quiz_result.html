{% extends 'base.html' %}
{% block content %}
<div class="min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4 py-12">
    <div class="max-w-2xl w-full bg-white rounded-3xl shadow-2xl overflow-hidden text-center p-10 border border-gray-100">
        
        {% if request.session.quiz_result.percentage >= 90 %}
            <div class="text-6xl mb-4 animate-bounce">ğŸ†</div>
            <h1 class="text-3xl font-black text-green-600 mb-2 leading-tight uppercase">Â¡Examen Aprobado!</h1>
            <p class="text-gray-500 mb-6 font-medium text-lg">Has superado el estÃ¡ndar de excelencia de MD Chile.</p>
        {% else %}
            <div class="text-6xl mb-4">ğŸ“‹</div>
            <h1 class="text-3xl font-black text-orange-500 mb-2 leading-tight uppercase">Sigue Practicando</h1>
            <p class="text-gray-500 mb-6 font-medium text-lg">Necesitas un 90% para aprobar este mÃ³dulo.</p>
        {% endif %}

        <div class="bg-blue-50 rounded-2xl p-6 mb-8 border-2 border-blue-100">
            <span class="block text-xs text-blue-400 font-bold uppercase tracking-widest mb-1">Tu Resultado Final</span>
            <span class="block text-6xl font-black text-blue-900 leading-none">
                {{ request.session.quiz_result.percentage }}%
            </span>
        </div>

        <div class="space-y-4 mb-8">
            <button onclick="document.getElementById('revision-panel').classList.toggle('hidden')" 
                    class="w-full bg-gray-100 text-gray-700 font-bold py-4 rounded-xl hover:bg-gray-200 transition uppercase text-sm tracking-wider">
                ğŸ” Ver revisiÃ³n detallada
            </button>
            
            <a href="{% url 'course_detail' request.session.quiz_result.course_id %}" 
               class="block w-full bg-blue-600 text-white font-black py-5 rounded-xl shadow-xl shadow-blue-100 hover:bg-blue-700 transition uppercase tracking-widest transform hover:scale-105">
                Continuar al Curso ğŸ“
            </a>
            
            {% if request.session.quiz_result.percentage < 90 %}
                <a href="{% url 'take_quiz' request.session.quiz_result.quiz_id %}" class="block w-full text-blue-600 font-black py-2 hover:underline text-sm uppercase tracking-tighter">
                    Reintentar examen ahora
                </a>
            {% endif %}
        </div>

        <div id="revision-panel" class="hidden text-left mt-8 border-t pt-8">
            <h2 class="text-xl font-black text-gray-800 mb-6 uppercase tracking-wider italic">RevisiÃ³n de respuestas:</h2>
            <div class="space-y-6">
                {% for item in request.session.quiz_result.review_data %}
                <div class="p-5 rounded-2xl border {% if item.is_correct %} bg-green-50 border-green-200 {% else %} bg-red-50 border-red-200 {% endif %}">
                    <p class="font-bold text-gray-800 mb-3">{{ forloop.counter }}. {{ item.question_text }}</p>
                    <div class="text-sm space-y-2">
                        <p class="{% if item.is_correct %} text-green-700 {% else %} text-red-700 {% endif %} font-medium">
                            <strong>Tu respuesta:</strong> {{ item.user_answer_text }}
                            {% if item.is_correct %} (Correcto âœ…) {% else %} (Incorrecto âŒ) {% endif %}
                        </p>
                        {% if not item.is_correct %}
                        <p class="text-green-800 font-bold bg-green-100 inline-block px-2 py-1 rounded-md">
                            <strong>Respuesta sugerida:</strong> {{ item.correct_answer_text }}
                        </p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            <button onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
                    class="mt-8 text-blue-600 font-bold text-xs w-full text-center hover:underline uppercase tracking-widest">
                â†‘ Volver arriba
            </button>
        </div>
    </div>
</div>
{% endblock %}